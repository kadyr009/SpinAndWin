using UnityEngine;
using System.Collections;

public class Invulnerability : MonoBehaviour
{
    public Sprite invulnerablilitySpite;

    private Sprite _ownSprite;
    private ParticleSystem.TextureSheetAnimationModule _textureSheetAnimation;

    private void OnEnable()
    {
        ParticleSystem particleSystem = gameObject.GetComponent<ParticleSystem>();

        if (particleSystem != null && invulnerablilitySpite != null)
        {
            _textureSheetAnimation = GetComponent<ParticleSystem>().textureSheetAnimation;

            if (_textureSheetAnimation.spriteCount > 0)
                _ownSprite = _textureSheetAnimation.GetSprite(0);
        }
        
        TriggerCollisionHandler.OnBecomeInvulnerable += BecomeInvulnerable;
    }

    private void OnDisable()
    {
        TriggerCollisionHandler.OnBecomeInvulnerable -= BecomeInvulnerable;
    }

    private void Start()
    {
        
    }

    private void BecomeInvulnerable(bool IsInvulnerable)
    {
        if (IsInvulnerable && _textureSheetAnimation.spriteCount > 0)
        {
            _textureSheetAnimation.SetSprite(0, invulnerablilitySpite);
        }
        else if (!IsInvulnerable)
        {
            _textureSheetAnimation.SetSprite(0, _ownSprite);
        }
    }
}
